<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FZ Balance (Cloud)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    input, button, textarea { padding: 0.5rem; margin: 0.2rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    .chart-container { width: 100%; max-width: 700px; margin: 2rem auto; }
  </style>
</head>
<body>
  <h1>ðŸ“Š FZ Balance Tracker (Google Sheets)</h1>

  <div>
    <label>Glucose (mmol/L): <input type="number" id="glucose"></label>
    <label>Uric Acid (Âµmol/L): <input type="number" id="uric"></label>
    <label>Ketone (mmol/L): <input type="number" id="ketone"></label><br>
    <label>Notes:<br><textarea id="notes" rows="2" cols="50"></textarea></label><br>
    <button onclick="submitEntry()">Submit to Google Sheet</button>
    <button onclick="fetchEntries()">ðŸ”„ Load Past Entries</button>
  </div>

  <table id="historyTable">
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>Glucose</th>
        <th>Uric Acid</th>
        <th>Ketone</th>
        <th>Notes</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
  const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwefsdIO5NkVSI6OuaRhRL1JK9_kfDYZ4LL8O_cbi8kv7J4J19AauFU97X2TfFgADX1CA/exec';

  function submitEntry() {
    const glucose = document.getElementById('glucose').value;
    const uric = document.getElementById('uric').value;
    const ketone = document.getElementById('ketone').value;
    const notes = document.getElementById('notes').value;

    if (!glucose || !uric || !ketone) return alert('Please fill in all fields');

    const data = {
      timestamp: new Date().toLocaleString('en-MY', {
      timeZone: 'Asia/Kuala_Lumpur',
      year: 'numeric',
      month: 'short',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      hour12: true}),
      glucose: parseFloat(glucose),
      uric: parseFloat(uric),
      ketone: parseFloat(ketone),
      notes: notes
    };

    fetch(GOOGLE_SCRIPT_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    })
    .then(() => {
      alert('Entry submitted!');
      fetchEntries();
    })
    .catch(() => alert('Submission failed.'));

    document.getElementById('glucose').value = '';
    document.getElementById('uric').value = '';
    document.getElementById('ketone').value = '';
    document.getElementById('notes').value = '';
  }

  function fetchEntries() {
    fetch(GOOGLE_SCRIPT_URL + '?action=read')
      .then(response => response.json())
      .then(data => {
        const tableBody = document.querySelector('#historyTable tbody');
        tableBody.innerHTML = '';
        data.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${row[4]}</td>`;
          tableBody.appendChild(tr);
        });
      })
      .catch(() => alert('Failed to load entries.'));
  }

  // ðŸ”„ Load entries automatically on page load
  window.onload = fetchEntries;
</script>
</body>
</html>
